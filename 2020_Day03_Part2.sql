SET NOCOUNT ON;
DECLARE @input TABLE (RowNum INT IDENTITY(1,1), input VARCHAR(MAX));

INSERT INTO @input(input)
SELECT a.input
FROM
(
VALUES 
('..#.#...#.#.#.##.....###.#....#'),
('...........##.#...#.#..........'),
('....#.....#..#.............#...'),
('.#....###..##...#...##...#.#..#'),
('#.......#.........#..#.......#.'),
('...#.##..##...#.#......#.##.#..'),
('#.#..##.....#.....#..##........'),
('...#.####...#.##...#...........'),
('.#...#..#..#....#.#.#.#.##.....'),
('##.#..#.##..#......#..##.#.#..#'),
('.#.##.....#.#...............#.#'),
('..##.#.....#.....##..##.#....#.'),
('#..#..........#...##........#..'),
('#..##.#.#...............#..#...'),
('..#....#...#.......#.......#...'),
('.........#.#.##.#........#.....'),
('#...##....#..#.........#.#...##'),
('...#.#...#...........#..#...#..'),
('...#..#........#...#...........'),
('.#....##.#...#.#....#....##....'),
('...#...#......#.#.......#...##.'),
('####..........##....#..........'),
('#..#...........................'),
('#....#...####..##.#......#.#...'),
('..#..#.....##.....#...#....#..#'),
('#.##......#..##........#.......'),
('..........#.....#...#.#.#....##'),
('....##...##..#........#...#..#.'),
('#..#..#...##..............##...'),
('###.##..##.###...#....##.#..#..'),
('.#......#.................#.#..'),
('#.#..#.##.#.#.#.....#.........#'),
('..##......#.......##........#..'),
('#..............#.##.#.....#....'),
('............................##.'),
('..#.##......#..........#....#..'),
('..##.....#..##.#....#.......##.'),
('..#.#.##.#.........#...........'),
('...........##.#.#...#......###.'),
('#....#...#........#.#...#.#.###'),
('..............#...#.....##....#'),
('#...#...#..............#..#...#'),
('.##..#.........#.##.#..#...##..'),
('.....#.........#..#..#.......#.'),
('.#......#.#.#....##..#...#..##.'),
('#....................#.#....#..'),
('......#.....##............#....'),
('.#.....#......####.....#....##.'),
('##.####.#..#..........#......#.'),
('##....................#..##....'),
('.....#...#.#.##.#.###.....#....'),
('.#..#...####.#.#...#.#.....#...'),
('#.....##.........##.##.##.....#'),
('....#....##.###.........#...###'),
('.......#........#.##.....#####.'),
('...#.##..#...#...####.....##...'),
('..#....#....#......#......#.#..'),
('...#.#.#.........#.......#..#..'),
('.....#...........#.#........##.'),
('..##...#.#.##.#.#.#...###.#....'),
('..##.............###....#.#....'),
('#.......#....#..#...#..##..#...'),
('....##..#.......####....#..#.##'),
('##....#...#.#.#...#...#........'),
('....#.#................#...#...'),
('...#.....#.#.......##....#.#..#'),
('#....##.#...#.#..#.#.........#.'),
('#..##.........##.....#...#.....'),
('....#.....#.#..#..##..##.##...#'),
('#.....#...#.#.#.##....#.#.##...'),
('.#.#........#..##.......#...#.#'),
('..###.....#..#.##....#...#....#'),
('...#..###...#...#.......#..#...'),
('.#....##.......#.#..........##.'),
('...#.#.............##.....##...'),
('..#..#...#.....#...#...........'),
('.#.#......#.##....#.....#......'),
('........#.#.....#.#...#..#.#..#'),
('#.....#.#.....#.##..#.#....#.#.'),
('..#..###.#.#........#.....##..#'),
('#.#....#......#.#....###..#...#'),
('...#.#....#..#.##.....#...#....'),
('....##....#.#...#.........#..##'),
('.#......#...#.............#..#.'),
('#........#........#.#.....##...'),
('..##..#.##..#........#.........'),
('.....#...#...#..#.....#.#.##.#.'),
('..#..#..#.........#...#.......#'),
('....#.....#.......#.##.#.##..##'),
('......#.......##...#......#....'),
('....#....##.......###.#......#.'),
('.....#..#.#........#....#.....#'),
('#...#...#....#...###........#..'),
('#...........####.......#.#..#.#'),
('..###....#..........#...#.###..'),
('....#.#.....#....#..#.....#.##.'),
('...##.#..#..#.......#......#.#.'),
('....#......###..#.....#.....#..'),
('.....#.#.#.....#.##.#....####..'),
('.##....#.....#.#....##..#......'),
('#..#.....#..#...#....#.#.......'),
('.##.#..####..#.##.#......#.....'),
('......#....#.......##.##....#..'),
('...#....#....#..##.......##.###'),
('..##..........##.............#.'),
('.#...#.#...##..##.....#..#.....'),
('....#.#.##...................#.'),
('.......#.#..#....#.....#.......'),
('.#.#..#....####...#.#.##....#..'),
('.#.##...#..#..#...#.#.......#..'),
('##.#.....##.........#.......#..'),
('.##...#.....#.........##.#....#'),
('.............#..#............##'),
('...##.......#.....#.......#.##.'),
('##..##.........................'),
('.##.#........#........#........'),
('.....#................#.#......'),
('.............#....#....##....#.'),
('#..##...##...#..#.#............'),
('.......#...####.#..#..#.....##.'),
('..#.#..#......#.....#.#.#.....#'),
('...#..##........#..#.#....#.#..'),
('.#.....#..###..#....#.##.#...#.'),
('#.#..#.##.#..#......#.###...#..'),
('##..#.#..###....##.#...#...##.#'),
('##..#.........#...##......#....'),
('#.#...#.#..#..........#.......#'),
('.......#.#.......#.....##..#...'),
('........#..##............##.#..'),
('........##.....#........#..#...'),
('#..##.#..###......##...........'),
('..#.....#.#.#....#...#.#..#..##'),
('#...............#.......#.#.##.'),
('#..#.....#....#............#.#.'),
('...#....#...#....#..#..###.....'),
('..#....#.#.....#..#......##.#.#'),
('.#.#....#..#...#....#........#.'),
('..##....##....#.....#.#........'),
('.#...#....##..##.....##.....##.'),
('.#...........#....##...##.#....'),
('...#.....#......###.##.#.......'),
('......#.#..##.#.#....#...#...##'),
('....#...###.##....#.#.....#....'),
('.......#.....#......#.....##..#'),
('.####.#...##..#....#...........'),
('................###...#....#..#'),
('...#...#.....###.#.##.......#..'),
('..#....#...##...#.###......#.#.'),
('#...#......#............#.....#'),
('#.........#...............#..#.'),
('...#.##.....#............#.....'),
('........#......##..#..#..#.#..#'),
('....#....#.....#.#.....##..#...'),
('.....#....#..##.....#..........'),
('.##....#..#...........##.......'),
('#......##.....#...#.....#......'),
('...#.....#......#.#....#.......'),
('...#................##...#..#..'),
('........#..........#....#......'),
('......#....#.#.#...........#.#.'),
('.#............#....##.......##.'),
('#.......#.....#...##.#..##.....'),
('.#.....#.##..#..#....#.#..#.#.#'),
('....#...............###........'),
('#####...........#..#.......#..#'),
('...#.......#...#.#............#'),
('#...#..#.#...#.#...#.##.....##.'),
('.#..#..#..#.....#....#...#.....'),
('.#...#......#.......#.........#'),
('.#....#.....#...#...#..#....#..'),
('#....#....#.......#.....##.....'),
('.#...#.#.##.#....#..##........#'),
('..##...#............#..........'),
('..........#..#..#...#....#.....'),
('..#.......#....#.....##..##....'),
('.#...#......#...#..###...#...#.'),
('..##...#......#...#.#.#...#....'),
('.....#..#.#.#.#.#...#....##..#.'),
('##..#..##....#.#........##.#...'),
('.##..#.#...##..#....#..#.......'),
('.....#...#...#..#.#..#......#..'),
('.#.....##.##..#....####..#....#'),
('......##.................#....#'),
('....##.......###...#.##...##.#.'),
('...#...#.................##.#..'),
('.#.....##...#...#.....#.....##.'),
('##.........####..#...#...#....#'),
('...##.....#......#.###..#......'),
('.....###..##.#.......###..##...'),
('#....#...#.#...#...#.#....#..#.'),
('#...#.........##.#.........###.'),
('#....#..###..........##........'),
('.###.....#.#.....#........##..#'),
('....#.........##..#..#.#.#..#..'),
('..#......#...........#..##...#.'),
('...#.#..#..#...#.##..#..#.....#'),
('.#...#...#....................#'),
('..#..##..#.............#.....#.'),
('.....###.#.#.#...##..#.##....#.'),
('..#...####..##.#....#...#...#..'),
('.....#..#........#.#.#..#.##...'),
('#.#.........####..#...#.#......'),
('..............#..#........#....'),
('....#........#......#.........#'),
('#..#.##......#.#.......#....#..'),
('....#..............#.#.#..#....'),
('#.#......#.....##.......#..##..'),
('.#.#..........#....#......#....'),
('.....#.......#.##.....#......##'),
('...#...#.##.............####...'),
('..#....##...#...##..#.#..##.#..'),
('..#.........##.......###.#.....'),
('..#.........#####..##...#......'),
('..#.#...#.......#.####......##.'),
('......#.#.#....#......####....#'),
('.###...........#...#..#..#..##.'),
('..#...#..##.##...#.#.##.....#..'),
('.....#..#....##.......#...#....'),
('......#.....#.........#..#..#..'),
('...#..#.........##.....##.#...#'),
('....##...#......#..#.....#.....'),
('....#..#....#....#........##...'),
('##.....#.......#.....#.#.#..#..'),
('.....#..##.....##.##.#.........'),
('.#.#..##.............#.#.......'),
('......#.##.#.....#.#......#..#.'),
('..........#.#..#....#.#.#.#..##'),
('...##.....#..#...#...#...##....'),
('........#.#......#..###..#.....'),
('..#.##......#.......#.......#..'),
('...#....##.##.........#.#......'),
('......#....#.#.........#......#'),
('.....#...#....#...#......#..#..'),
('.##...#......#.........#...#.#.'),
('..#.#.#......#....#............'),
('..#.....##.............#.##.##.'),
('#......#......#...##.......#.#.'),
('##........#.....#..............'),
('.#.###.................#.#....#'),
('........##.#..##........#.#....'),
('.......###...#...##.#..#....#..'),
('.#..#....#..#......##......#...'),
('.#...#....#..........##..##.#..'),
('.#..###.......#............#...'),
('...#.....###.#..#........#.#.#.'),
('...#....#..#.##..........#.#.#.'),
('.#..##..#.....#...........#....'),
('#...#...##....#..#....##.......'),
('#..#......#................#...'),
('#..##....#.#..#......#.#.#.....'),
('##.#..#...#.....#.#...#......##'),
('#....#.#.#....#.....##.....##..'),
('....#...##.#...####.#.#.#.#..#.'),
('.....#.#....#..#.....#..#......'),
('.........#.#...................'),
('........#.....####......#..#..#'),
('.#.#.##.#...#.#......#...##.##.'),
('.#......#.#.#...#..#.......#...'),
('..#......#.##.##.#.#....#......'),
('..........#.#...###............'),
('.##..#..#.#.#..#.....#..#.#....'),
('......#.......#.#..#.#....#...#'),
('.#.......###......#...#.#.#....'),
('.............##..#..#...#....#.'),
('....#......#.#...#.#...#...#...'),
('..#....#.......#.#..#..#.#..#.#'),
('.#..#.#...#.....#.#...#####...#'),
('.##............#....#..........'),
('#.......####...#.#.#...........'),
('...#.......##.#..........#....#'),
('..#.#......#.......##.....#..##'),
('#......#.###..#......#......#.#'),
('##....#..#....#.##....#..#.....'),
('...##...#.#....#.#.......#.....'),
('#...####....#..#.#..#.##....###'),
('.....#..#..........###..#......'),
('.#..#..#...#....#.##..#..#.....'),
('#..#.....#....#..#.##...##.....'),
('.....###.#..#.......#...###.##.'),
('#..#........#.#..#.#.........#.'),
('....##........................#'),
('.#....#.#.#.#.#...#......#....#'),
('#....#...#.##.......#.#.###....'),
('..........###..##....#..##.#...'),
('...##..###...#.#.#.......##...#'),
('##.#...#..#.....###....#.......'),
('..#..##....###........##....###'),
('.....##..#...#..#.....#..#....#'),
('#................#....#...#..##'),
('#....#.#....#..###.#.#...#..#.#'),
('........##.#...#.#.#.#...#.....'),
('..#..###....#......##.#...##...'),
('..#..##....#.##..#.....#.....#.'),
('.#.#...#.....#..#..#......##.#.'),
('........#.#...#..##....#..#....'),
('...##...#...#...#...##...##..#.'),
('.......#..#..#....#.#..#...##..'),
('.#.....#.##........#...#.#.....'),
('##.#..#....#.#....#.#....#...#.'),
('..#.#......#.......##...#....#.'),
('#.#..####..#........#.......###'),
('....#.......#.......##.#...#.#.'),
('..#..#.#.............#..#......'),
('........###.....##....#.......#'),
('...#.....#...#...#....#.###....'),
('#...##.#........#..#...##..#..#'),
('...##..#....#....#.#.#...#.#...'),
('#......#.....#....###......##..'),
('.....#.........####...##..#....'),
('.......#...##...#..#..#.#......'),
('.#.#....#.....#.......#........'),
('...##...#....##..#.....###.....'),
('.#....#........##......#....#.#'),
('.........#.#.#.#...........#.#.'),
('....#.#..##......#.#.#..##.....'),
('.........#.....##....#.........'),
('....#.............#...........#'),
('...#..##........#.....###......'),
('#....#....#......#..#..#..#.#..'),
('#......##.....#..#....#..#.#...'),
('#..............#....#.#....###.'),
('..##..#..#...#...##........##..'),
('..#.##....#..#......###..#.....')
) a(input)

DECLARE @y INT = 1;

DECLARE @Len INT = (SELECT TOP(1) LEN(input) FROM @input i)
DECLARE @Count INT = (SELECT COUNT(*) FROM @input i)

DECLARE @slopes TABLE (slopeID INT IDENTITY(1,1), lr INT, ud INT, treeCount INT DEFAULT 0, loopX INT DEFAULT 1, x INT DEFAULT 1, y INT DEFAULT 1, multipled BIT DEFAULT 0)

INSERT INTO @slopes (lr, ud)
values 
 (1,1)
,(3,1)
,(5,1)
,(7,1)
,(1,2)

WHILE @y <= @Count
BEGIN

	update @slopes
	SET loopx = coalesce(NULLIF(x % @len, 0), @len)
	
	UPDATE s
	SET 
		 s.treecount += CASE WHEN SUBSTRING(input, loopx, 1) = '#' THEN 1 ELSE 0 END
		,s.x += lr
		,s.y+=ud
	from @slopes s
	CROSS APPLY @input i
	WHERE s.y = i.RowNum
		AND s.y = @y
	
	update @slopes 
	set x += lr, y+=ud
	WHERE y = @y
	
	set @y+=1

END

DECLARE @Answer BIGINT = 1;
DECLARE @loopMulti INT = 1
WHILE EXISTS(SELECT NULL FROM @slopes s WHERE s.multipled = 0)
BEGIN

	SELECT @Answer = @Answer * s.treeCount
	FROM @slopes s
	WHERE s.slopeID = @loopMulti

	UPDATE @slopes SET multipled = 1 WHERE slopeID = @loopMulti
	SELECT @loopMulti +=1;

END

SELECT 'Answer' = @Answer